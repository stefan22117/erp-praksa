/*
 * jQuery Timer - a jQuery Plugin, that counts time
 * http://humnom.net/timer/
 *
 * Copyright 2011, Yuri Sizov <yuris@humnom.net> - http://humnom.net
 * Released under the GPL License Version 2.
 *
 * Version: 1.1
 * Date: Thu Mar 07 2011 15:29:30 +0300
 */

(function($){$.fn.timer=function(settings,callback){if(this.data("timer")&&this.data("timer").exists)return!1;var defaults={autostart:!1,direction:"cw",format:"{h}:{m}:{s}",startVal:0,stopVal:10,loop:!1};this.data("timer",[]);var timer=this.data("timer");timer.options=$.extend(defaults,settings),timer.options.startVal=parseInt(timer.options.startVal),timer.options.stopVal=parseInt(timer.options.stopVal),timer.options.startVal<0&&(timer.options.startVal=0),timer.options.stopVal<0&&(timer.options.stopVal=0),timer.exists=!0,timer.target=this,timer.interval=!1,timer.currentVal=timer.options.startVal,timer.step=1e3,timer.callback=callback||function(){},timer.debug={index:"#"+timer.target.attr("id")},this.startTimer=function(){timer.interval||(timer.options.direction=="cw"?timer.interval=setInterval(timer.increase,timer.step):timer.options.direction=="ccw"&&(timer.interval=setInterval(timer.decrease,timer.step)))},this.stopTimer=function(){timer.interval&&(clearInterval(timer.interval),timer.interval=!1)},this.resetTimer=function(){timer.interval&&(clearInterval(timer.interval),timer.interval=!1),timer.target.text(timer.formate(timer.options.startVal)),timer.currentVal=timer.options.startVal},this.destroyTimer=function(){timer.interval&&(clearInterval(timer.interval),timer.interval=!1),this.removeData("timer")},this.setTimerOptions=function(a){timer.options=$.extend(timer.options,a)},this.rewindTimer=function(a){a||(a=0),a<timer.options.startVal&&(a=timer.options.startVal),a>timer.options.stopVal&&(a=timer.options.stopVal),timer.currentVal=a,timer.target.text(timer.formate(timer.currentVal))},timer.formate=function(a){var b="",c=timer.options.format;if(c.indexOf("{s}")>=0){var d=Math.floor(parseInt(a));d<10&&(d="0"+d)}if(c.indexOf("{m}")>=0){var d=Math.floor(parseInt(a%60));d<10&&(d="0"+d);var e=Math.floor(parseInt(a/60));e<10&&(e="0"+e)}if(c.indexOf("{h}")>=0){var d=Math.floor(parseInt(a%60));d<10&&(d="0"+d);var e=Math.floor(parseInt(a/60%60));e<10&&(e="0"+e);var f=Math.floor(parseInt(a/60/60));f<10&&(f="0"+f)}if(c.indexOf("{d}")>=0){var d=Math.floor(parseInt(a%60));d<10&&(d="0"+d);var e=Math.floor(parseInt(a/60%60));e<10&&(e="0"+e);var f=Math.floor(parseInt(a/60/60)%24);f<10&&(f="0"+f);var g=Math.floor(parseInt(a/60/60/24))}if(c.indexOf("{w}")>=0){var d=Math.floor(parseInt(a%60));d<10&&(d="0"+d);var e=Math.floor(parseInt(a/60%60));e<10&&(e="0"+e);var f=Math.floor(parseInt(a/60/60)%24);f<10&&(f="0"+f);var g=Math.floor(parseInt(a/60/60/24)%7),h=Math.floor(parseInt(a/60/60/24)/7)}h!=undefined&&(c=c.replace("{w}",h)),g!=undefined&&(c=c.replace("{d}",g)),f!=undefined&&(c=c.replace("{h}",f)),e!=undefined&&(c=c.replace("{m}",e)),d!=undefined&&(c=c.replace("{s}",d)),b=c;return b},timer.increase=function(){timer.currentVal<timer.options.stopVal?(timer.currentVal++,timer.target.text(timer.formate(timer.currentVal)),timer.currentVal==timer.options.stopVal&&timer.onFinish()):timer.onFinish()},timer.decrease=function(){timer.currentVal>timer.options.stopVal?(timer.currentVal--,timer.target.text(timer.formate(timer.currentVal)),timer.currentVal==timer.options.stopVal&&timer.onFinish()):timer.onFinish()},timer.onFinish=function(){clearInterval(timer.interval),timer.interval=!1,eval(timer.callback()),timer.options.loop&&(timer.target.resetTimer(),timer.target.startTimer())},timer.target.text(timer.formate(timer.options.startVal)),timer.options.autostart&&this.startTimer();return this}})(jQuery)